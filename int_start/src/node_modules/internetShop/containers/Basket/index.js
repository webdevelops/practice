import React from 'react'
import { connect } from 'react-redux'
import { Link } from 'react-router-dom'
import PropTypes from 'prop-types'

import {
  getBasketPhonesWithCount,
  getTotalBasketPrice
} from 'internetShop/selectors'

import { 
  clearBasket, 
  checkoutBasket, 
  removePhoneFromBasket 
} from 'internetShop/actions'

const Basket = ({
  phones,
  totalBasketPrice,
  clearBasket,
  checkoutBasket,
  removePhoneFromBasket
}) => {
  const renderPhone = (phone, index) => {
    return (
      <tr key={index} className='table-phone'>
        <td>
          <div className="table-phone__image">
            <img src={phone.image} alt={phone.name} />
          </div>
        </td>
        <td>{phone.name}</td>
        <td>${phone.price}</td>
        <td>{phone.count}</td>
        <td>
          <i
            className="fas fa-trash-alt"
            onClick={() => removePhoneFromBasket(phone.id)}
          ></i>
        </td>
      </tr>
    )
  }

  const renderContent = () => {
    return (
      <div>
        {phones.length === 0 && <h2>Your shopping cart is empty.</h2>}
        <table>
          <tbody>
            {phones.map((phone, index) => renderPhone(phone, index))}
          </tbody>
        </table>
        {
          phones.length > 0 &&

          <div className='basket__total-price'>
            <b>Total:</b> ${totalBasketPrice}
          </div>
        }
      </div>
    )
  }

  const renderSidebar = () => {
    return (
      <div>
        <h3>Quick shop</h3>
        <Link
          to='/'
          className="button button-block"
        >
          <i className="fas fa-info-circle"></i>
          Continue shopping!
        </Link>
        <button
          className="button button-block button-danger"
          onClick={clearBasket}
        >
          <i className="fas fa-trash-alt"></i>
          Clear basket
        </button>
        <button
          className="button button-block button-warning"
          onClick={() => checkoutBasket(phones)}
        >
          <i className="fas fa-envelope"></i>
          Checkout
        </button>
      </div>
    )
  }

  return (
    <div className='basket'>
      <div className="basket__content">
        {phones && renderContent()}
      </div>
      <div className="basket__sidebar">
        {renderSidebar()}
      </div>
    </div>
  )
}

const mapStateToProps = state => {
  return {
    phones: getBasketPhonesWithCount(state),
    totalBasketPrice: getTotalBasketPrice(state)
  }
}

const mapDispatchToProps = {
  clearBasket,
  checkoutBasket,
  removePhoneFromBasket
}

Basket.propTypes = {
  phones: PropTypes.array,
  totalBasketPrice: PropTypes.number,
  clearBasket: PropTypes.func,
  checkoutBasket: PropTypes.func,
  removePhoneFromBasket: PropTypes.func
}

export default connect(mapStateToProps, mapDispatchToProps)(Basket)